<div class="layout-container">
    <app-side-menu></app-side-menu>
    <div class="content-area">
      <app-main-header></app-main-header>
      <div class="container-fluid">
        <div class="row" style="padding-top: 100px;">
          <div class="col-sm-12">
            <div class="d-flex justify-content-between align-items-center">
              <!-- Select item and Add User button in one line -->
              <div class="d-flex align-items-center">
                <ng-select style="width: 200px;" placeholder="Select item" appendTo="body" 
                  [(ngModel)]="selectedOrganisationId" (change)="getContactUsers()">
                  <ng-option [value]="0">Select</ng-option>
                  <ng-option *ngFor="let org of organisationsList" [value]="org.organisationDetailsId">
                    {{org.institutionName}}
                  </ng-option>
                </ng-select>
                <button class="btn btn-primary ml-3" data-target="#addContact" data-toggle="modal" (click)="validateAddUser()">Add User</button>
              </div>
          
              <!-- Search bar on the right -->
              <div>
                <input type="text" placeholder="Search" style="padding:8px 12px;height:35px;" [(ngModel)]="searchText" 
                  (ngModelChange)="applyFilter()" matInput #input>
              </div>
            </div>
          </div>
          
       
            <section class="example-container" style="margin-top: 10px;">
              <table id="table1" mat-table [dataSource]="usersDataSource"
               matSort class="mat-elevation-z8">
  
                <!-- <ng-container matColumnDef="checkbox">
                  <th mat-header-cell *matHeaderCellDef>
                    <input type="checkbox" id="mainCheckBox" />
                  </th>
                  <td mat-cell *matCellDef="let user; let i = index">
                    <input type="checkbox" id="subCheckBox{{i}}" class="subCheckBox" value="{{i}}" />
                  </td>
                </ng-container> -->
  
  
                <ng-container matColumnDef="id">
                  <th mat-header-cell *matHeaderCellDef mat-sort-header>Id</th>
                  <td (click)="navigateToDomainDetails(user.id)" mat-cell *matCellDef="let user; let i = index">
                    {{i+1}}</td>
                </ng-container>

                <ng-container matColumnDef="organisationName">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Organisation Name</th>
                    <td mat-cell *matCellDef="let user">
                      {{user.organisationDetails.institutionName}}</td>
                  </ng-container>
  
  
                <ng-container matColumnDef="personName">
                  <th mat-header-cell *matHeaderCellDef mat-sort-header>Person Name</th>
                  <td mat-cell *matCellDef="let user">{{user.personName}}</td>
                </ng-container>
  
  
                <ng-container matColumnDef="designation">
                  <th mat-header-cell *matHeaderCellDef mat-sort-header>Designation</th>
                  <td mat-cell *matCellDef="let user">{{user.designation}}</td>
                </ng-container>
  
                <ng-container matColumnDef="mobileNumber">
                  <th mat-header-cell *matHeaderCellDef mat-sort-header>MobileNumber</th>
                  <td mat-cell *matCellDef="let user">{{user.mobileNumber}}</td>
                </ng-container>
  
  
                <ng-container matColumnDef="emailId">
                  <th mat-header-cell *matHeaderCellDef mat-sort-header>EmailId</th>
                  <td mat-cell *matCellDef="let user">{{user.emailId}}</td>
                </ng-container>

                <ng-container matColumnDef="contactRole">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Role</th>
                    <td mat-cell *matCellDef="let user">{{user.contactRole}}</td>
                  </ng-container>

                  <ng-container matColumnDef="approveOrReject">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Approve/Reject Login</th>
                    <td mat-cell *matCellDef="let user">
                        <div>
                            <span class="approved" [ngClass]="user.loginStatus=='Approved'?'disableApprRejec':''" (click)="enableOrDisableLoginStatus('Approved',user)">
                                <svg width="24" height="25" viewBox="0 0 24 25" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <rect y="0.5" width="24" height="24" rx="2" fill="#C3FFC3" fill-opacity="0.5"/>
                                    <path d="M15 19.25V17.75C15 16.9544 14.6839 16.1913 14.1213 15.6287C13.5587 15.0661 12.7956 14.75 12 14.75H6.75C5.95435 14.75 5.19129 15.0661 4.62868 15.6287C4.06607 16.1913 3.75 16.9544 3.75 17.75V19.25" stroke="#008000" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M9.375 11.75C11.0319 11.75 12.375 10.4069 12.375 8.75C12.375 7.09315 11.0319 5.75 9.375 5.75C7.71815 5.75 6.375 7.09315 6.375 8.75C6.375 10.4069 7.71815 11.75 9.375 11.75Z" stroke="#008000" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M15.75 11.75L17.25 13.25L20.25 10.25" stroke="#008000" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                            </span>&nbsp;&nbsp;&nbsp;&nbsp;
                            <span class="rejected" [ngClass]="user.loginStatus=='Approved'?'disableApprRejec':''" (click)="enableOrDisableLoginStatus('Rejected',user)">
                                <svg width="24" height="25" viewBox="0 0 24 25" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <rect y="0.5" width="24" height="24" rx="2" fill="#FF9393" fill-opacity="0.5"/>
                                    <path d="M15 19.25V17.75C15 16.9544 14.6839 16.1913 14.1213 15.6287C13.5587 15.0661 12.7956 14.75 12 14.75H6.75C5.95435 14.75 5.19129 15.0661 4.62868 15.6287C4.06607 16.1913 3.75 16.9544 3.75 17.75V19.25" stroke="#FF0000" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M9.375 11.75C11.0319 11.75 12.375 10.4069 12.375 8.75C12.375 7.09315 11.0319 5.75 9.375 5.75C7.71815 5.75 6.375 7.09315 6.375 8.75C6.375 10.4069 7.71815 11.75 9.375 11.75Z" stroke="#FF0000" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M16.5 9.5L20.25 13.25" stroke="#FF0000" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M20.25 9.5L16.5 13.25" stroke="#FF0000" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                            </span>
                        </div>
                    </td>
                  </ng-container>

                <ng-container matColumnDef="documents">
                  <th mat-header-cell *matHeaderCellDef mat-sort-header>Verify Documents</th>
                  <td mat-cell *matCellDef="let user">
                    <a (click)="navigateToVerifyDocuments(user)"
                     style="cursor: pointer;text-decoration: underline;color: blue;">View</a>
                  </td>
                </ng-container>

                <ng-container matColumnDef="loginStatus">
                  <th mat-header-cell *matHeaderCellDef mat-sort-header>Login Status</th>
                  <td mat-cell *matCellDef="let user">
                    <div>{{user.loginStatus?user.loginStatus:'NA'}}</div>
                  </td>
                </ng-container>
                

                <ng-container matColumnDef="isActive">
                  <th mat-header-cell *matHeaderCellDef mat-sort-header>Is Active</th>
                  <td mat-cell *matCellDef="let user">
                    <div *ngIf="user.isActive==null">{{user.isActive?user.isActive:'NA'}}</div>
                    <div *ngIf="user.isActive!=null">{{user.isActive}}</div>
                  </td>
                </ng-container>

                <ng-container matColumnDef="actions">
                  <th mat-header-cell *matHeaderCellDef mat-sort-header>Actions</th>
                  <td mat-cell *matCellDef="let user">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                      <path
                        d="M12 3H5C4.46957 3 3.96086 3.21071 3.58579 3.58579C3.21071 3.96086 3 4.46957 3 5V19C3 19.5304 3.21071 20.0391 3.58579 20.4142C3.96086 20.7893 4.46957 21 5 21H19C19.5304 21 20.0391 20.7893 20.4142 20.4142C20.7893 20.0391 21 19.5304 21 19V12"
                        stroke="#9A9A9A" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                      <path
                        d="M18.3751 2.62523C18.7729 2.2274 19.3125 2.00391 19.8751 2.00391C20.4377 2.00391 20.9773 2.2274 21.3751 2.62523C21.7729 3.02305 21.9964 3.56262 21.9964 4.12523C21.9964 4.68784 21.7729 5.2274 21.3751 5.62523L12.3621 14.6392C12.1246 14.8765 11.8313 15.0501 11.5091 15.1442L8.63609 15.9842C8.55005 16.0093 8.45883 16.0108 8.372 15.9886C8.28517 15.9663 8.20592 15.9212 8.14254 15.8578C8.07916 15.7944 8.03398 15.7151 8.01174 15.6283C7.98949 15.5415 7.991 15.4503 8.01609 15.3642L8.85609 12.4912C8.95062 12.1693 9.12463 11.8763 9.36209 11.6392L18.3751 2.62523Z"
                        stroke="#9A9A9A" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        (click)="getUserById(user.id, user.contactRole)" style="cursor: pointer;" data-toggle="modal"
                        data-target="#userModal" />
                    </svg>
                  </td>
                </ng-container>
  
                <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
  
                <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
              </table>
            </section>
            <mat-paginator style="font-size: 13px;" [pageSizeOptions]="[5, 10, 20 ]" showFirstLastButtons [pageSize]="10"
              aria-label="Select page of periodic elements">
            </mat-paginator>
          </div>
        </div>
      </div>
    </div>
  

  <!-- Add Contact User modal -->
  <div *ngIf="selectedOrganisationId != 0" class="modal" id="addContact" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-xl" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Add Contact</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <!-- <p>Modal body text goes here.</p> -->
          <ng-select style="width: 250px;" [(ngModel)]="selectedOfficerToAdd" bindLabel="value" bindValue="key" placeholder="choose officer">
            <ng-option value='' disabled>select</ng-option>
            <ng-option *ngFor="let option of options" [value]="option.key">
              {{ option.key }}
            </ng-option>
          </ng-select>
          <div>
            <app-contact-details-form 
                  [choosenContactType]="selectedOfficerToAdd"
                  [choosenOrgId] ="selectedOrganisationId" 
                  (adminDocDetails)="SubmittedAdminDocs($event)" 
                  (techDocDetails)="submittedTechDocDetails($event)"
                  (billDocDetails)="submittedBillDocDetails($event)"
                  ></app-contact-details-form> 
          </div>
          <!-- <div *ngIf="selectedOfficerToAdd === 'AdminOfficer'">
            <p>Admin Officer</p>
          </div>
          <div *ngIf="selectedOfficerToAdd === 'TechnicalOfficer'">
            <p>Technical Officer</p>
          </div>
          <div *ngIf="selectedOfficerToAdd === 'BillingOfficer'">
            <p>Billing Officer</p>
          </div> -->
        </div>
        <div class="modal-footer">
          <!-- <button type="button" class="btn btn-primary">Save changes</button> -->
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>
  
  